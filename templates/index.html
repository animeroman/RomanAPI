<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add New Anime</title>
  </head>
  <body>
    <h1>Add New Anime</h1>
    <form id="animeForm">
      <label for="id">ID:</label><br />
      <input
        type="text"
        id="id"
        name="id"
        value="12345"
        placeholder="Enter anime ID (e.g., 32281)"
        required
      /><br /><br />

      <label for="animeEnglish">English Title:</label><br />
      <input
        type="text"
        id="animeEnglish"
        name="animeEnglish"
        value="Test Anime"
        placeholder="Enter the English title (e.g., Your Name)"
        required
      /><br /><br />

      <label for="animeOriginal">Original Title:</label><br />
      <input
        type="text"
        id="animeOriginal"
        name="animeOriginal"
        value="テストアニメ"
        placeholder="Enter the original title (optional)"
      /><br /><br />

      <label for="genres">Genres (comma-separated):</label><br />
      <input
        type="text"
        id="genres"
        name="genres"
        value="Action, Fantasy"
        placeholder="Enter genres (e.g., Drama, Romance)"
      /><br /><br />

      <button type="submit">Add Anime</button>
    </form>

    <p id="responseMessage"></p>

    <script>
      document
        .getElementById('animeForm')
        .addEventListener('submit', async function (event) {
          event.preventDefault();

          const newAnime = {
            id: document.getElementById('id').value,
            animeEnglish: document.getElementById('animeEnglish').value,
            animeOriginal: document.getElementById('animeOriginal').value,
            genres: document
              .getElementById('genres')
              .value.split(',')
              .map(g => g.trim()),
          };

          try {
            const response = await fetch('/api/anime', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(newAnime),
            });

            if (!response.ok) {
              const errorData = await response.json();
              document.getElementById(
                'responseMessage'
              ).innerText = `Error: ${errorData.error}`;
            } else {
              const result = await response.json();
              document.getElementById('responseMessage').innerText =
                result.message;
            }
          } catch (error) {
            document.getElementById('responseMessage').innerText =
              'Error: ' + error.message;
          }
        });
    </script>
  </body>
</html>
